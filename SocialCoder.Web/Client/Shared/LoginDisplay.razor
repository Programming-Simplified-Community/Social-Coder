@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using System.Security.Claims
@using SocialCoder.Web.Shared

@inject NavigationManager Navigation
@inject IdentityAuthenticationStateProvider AuthStateProvider

<AuthorizeView>
    <Authorized>
        <MudButton>
            @{
                var isAdmin = context.User.Claims.Any(x => x.Type == ClaimTypes.Role && x.Value == Roles.Administrator);
                var iconColor = isAdmin ? Color.Tertiary : Color.Inherit;
                var iconClass = isAdmin ? Icons.Filled.AdminPanelSettings : Icons.Filled.ManageAccounts;
            }
            <MudIcon Color="@iconColor"
                     Icon="@iconClass"/>
            &nbsp;@(context.User.Identity?.Name)
        </MudButton>
        <MudButton OnClick="BeginSignOut" Style="margin-right: 1.25rem;">
            <MudIcon Icon="@Icons.Filled.Logout"/>
            Logout
        </MudButton>
    </Authorized>
    <NotAuthorized>
        <MudButton OnClick="ToLogin">
            <MudIcon Icon="@Icons.Filled.Login" Color="Color.Inherit"/>
            &nbsp;Login
        </MudButton>
    </NotAuthorized>
</AuthorizeView>

@code{
    private async Task BeginSignOut(MouseEventArgs args)
    {
        await AuthStateProvider.Logout();
        Navigation.NavigateTo("/");
    }

    void ToLogin() => Navigation.NavigateTo("/login");
}
